<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">(function(){
    &#39;use strict&#39;;
<span id='Global-data-model-Model'>    /**
</span>     * @class Global.data.model.Model
     * @extend Global.core.ObservableClass,
     */
    Global.define(&#39;Global.data.model.Model&#39;,{

        extend: Global.core.ObservableClass,

        eventName: {
<span id='Global-data-model-Model-event-load'>            /**
</span>             * @event load
             * Fired when data is loaded
             * @param {Global.data.model.Model} target this class.
             * @param {String} eventName this event name.
             * @param {Object} data data of this event.
             */
            LOAD: &#39;load&#39;,
<span id='Global-data-model-Model-event-error'>            /**
</span>             * @event error
             * Fired when reqesting is failed
             * @param {Global.data.model.Model} target this class.
             * @param {String} eventName this event name.
             */
            ERROR: &#39;error&#39;
        },

<span id='Global-data-model-Model-cfg-isGetCurrentTime'>        /**
</span>         * @cfg {Boolean} isGetCurrentTime whether server get time in xhr or not.
         */
        isGetCurrentTime: false,

<span id='Global-data-model-Model-cfg-currentTime'>        /**
</span>         * @cfg {Date} currentTime current time based on http header when you request
         */
        currentTime: null,

<span id='Global-data-model-Model-cfg-proxy'>        /**
</span>         * @cfg {Global.data.proxy.Proxy} proxy
         */
        proxy : Global.data.proxy.Proxy,

<span id='Global-data-model-Model-cfg-requestSettings'>        /**
</span>         * @cfg {Object} requestSettings request settings of $.ajax method
         *
         *      requestSettings: {
         *          GET: {
         *              type: &#39;GET&#39;,
         *              dataType: &#39;json&#39;
         *          }
         *      }
         */
        requestSetting: {
            GET: {
                type: &#39;GET&#39;,
                dataType: &#39;json&#39;
            }
        },

<span id='Global-data-model-Model-cfg-requestParam'>        /**
</span>         * @cfg {Object} requestParam request parameter of $.ajax({data: {}})
         *
         *      requestParam: {
         *          GET: {},
         *          POST: {},
         *          DELETE: {},
         *          PUT: {}
         *      }
         */
        requestParam: {
            GET: {}
        },

<span id='Global-data-model-Model-cfg-data'>        /**
</span>         * @cfg {Object|String} data data of response
         */
        data: null,

<span id='Global-data-model-Model-method-constructor'>        /**
</span>         * @constructor
         */
        init: function(config){
            this._super(config);
            this.proxy = new this.proxy();
        },

<span id='Global-data-model-Model-method-get'>        /**
</span>         * @method get
         * get data by using $.ajax
         * @param {Object} parameter of $.ajax(data: {});
         * @return {Object} jquery.Deferred
         */
        get: function(param){
            var _param = this._getRequestObj(&#39;GET&#39;, param);
            return this._request(_param);
        },

<span id='Global-data-model-Model-method-_request'>        /**
</span>         * @method
         * @private
         */
        _request: function(param) {
            var me = this,
                dfd = $.Deferred(),
                ajaxDfd = this.proxy.get(param);

            ajaxDfd.done(function(e, state, xhr){
                me._onSuccess(e, state, xhr);
                dfd.resolve(e, state, xhr);
                me.dispatchEvent(me.eventName.LOAD, e);
            });

            ajaxDfd.fail(function(e, state, xhr){
                dfd.reject(e, state, xhr);
                me.dispatchEvent(me.eventName.ERROR, e);
            });

            return dfd.promise();
        },

<span id='Global-data-model-Model-method-_getRequestObj'>        /**
</span>         * @method
         * @private
         */
        _getRequestObj: function(type, param) {
            var requestSettings = this.getRequestSetting()[type],
                requestParam = this.getRequestParam()[type],
                _param = $.extend(true, {}, requestParam, param);

            requestSettings.data = _param;
            return requestSettings;
        },

<span id='Global-data-model-Model-method-_onSuccess'>        /**
</span>         * @method
         * @private
         */
        _onSuccess: function(e, state, xhr){
            var time = xhr ? xhr.getResponseHeader(&#39;Date&#39;) : undefined;
            this._setCurrentTime(time);

            var _data = this._modifyData(e);
            this.setData(_data);
        },

<span id='Global-data-model-Model-method-_setCurrentTime'>        /**
</span>         * @method
         * @private
         */
        _setCurrentTime: function(time) {
            if(this.getIsGetCurrentTime() &amp;&amp; time){
                this.setCurrentTime(new Date(time));
            }
        },

<span id='Global-data-model-Model-method-_modifyData'>        /**
</span>         * @method
         * @private
         */
        _modifyData: function(data){
            // override if you need.
            return data;
        }
    });
})();
</pre>
</body>
</html>
